<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>Fuji-Haya Electric - Game</title>
    <!-- favicon -->
    <link
      rel="icon"
      type="image/x-icon"
      href="assets\FUJI-HAYA LOGO [2.5k pix].png"
      sizes="16x16"
    />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="mobile-web-app-capable" content="yes" />

    <script type="text/javascript" src="phaser.min.js"></script>
    <script type="text/javascript" src="volume-meter.js"></script>
    <script type="text/javascript" src="controller.js"></script>
    <link rel="stylesheet" href="style.css" />

    <!-- Bootstrap -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"
      integrity="sha384-Gn5384xqQ1aoWXA+058RXPxPg6fy4IWvTNh0E263XmFcJlSAwiGgFAW/dAiS6JXm"
      crossorigin="anonymous"
    />
    <script
      src="https://code.jquery.com/jquery-3.2.1.slim.min.js"
      integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/popper.js@1.12.9/dist/umd/popper.min.js"
      integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/js/bootstrap.min.js"
      integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
      crossorigin="anonymous"
    ></script>

    <!-- Game font -->
    <link href="https://fonts.cdnfonts.com/css/games" rel="stylesheet" />

    <style>
      body {
        background: url("assets/electric.webp") no-repeat fixed center;
        -webkit-background-size: cover;
        -moz-background-size: cover;
        -o-background-size: cover;
        background-size: cover;
        overflow: hidden;
        touch-action: none;
        -ms-touch-action: none;
      }
      #prizes {
        position: absolute;
        right: 5rem;
        top: 7rem;
        color: #0077ff;
      }
      canvas {
        touch-action: none;
        -ms-touch-action: none;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
        -webkit-tap-highlight-color: transparent;
      }
      #gameContainer {
        touch-action: none;
        -ms-touch-action: none;
      }
    </style>
  </head>
  <body style="background-color: #181717">
    <!-- Modal -->
    <div
      class="modal fade"
      id="exampleModalCenter"
      tabindex="-1"
      role="dialog"
      aria-labelledby="exampleModalCenterTitle"
      aria-hidden="true"
      style="pointer-events: none"
    >
      <div
        class="modal-dialog modal-dialog-centered"
        role="document"
        style="min-width: 650px; pointer-events: auto"
      >
        <div
          class="modal-content"
          style="background-color: rgb(218, 232, 250); border-radius: 30px"
        >
          <div class="modal-header">
            <h5
              class="modal-title"
              id="exampleModalLongTitle"
              style="font-size: 25px; font-family: 'Games', sans-serif"
            >
              Game Instructions üéÆ
            </h5>
            <img
              src="assets/electric-man.png"
              alt="Instructions Icon"
              style="
                width: 80px;
                height: 30%;
                margin-left: 10px;
                position: absolute;
                right: 5.5rem;
                top: -85px;
              "
            />
            <button
              type="button"
              class="close"
              data-dismiss="modal"
              aria-label="Close"
              style="pointer-events: auto"
            >
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div
            class="modal-body"
            style="font-size: 20px; line-height: 1.6; color: #333"
          >
            <ul style="list-style-type: none; padding: 0">
              <li style="margin-bottom: 15px">
                1. <strong>Dodge the pipes</strong> - Don't let the circuit
                breaker get stuck!
              </li>
              <li style="margin-bottom: 15px">
                2. <strong>Tap to fly</strong> - Touch the screen to make the
                circuit breaker soar! üì±
              </li>
              <li style="margin-bottom: 15px">
                3. <strong>Stay alert</strong> - Unexpected twists are coming
                your way! ‚ö°
              </li>
              <li style="margin-bottom: 15px">
                4. <strong>Aim high</strong> - The higher your score, the bigger
                the prize! üèÜ
              </li>
              <li>
                5. <strong>Enjoy the ride</strong> - It's all about fun! üòä
              </li>
              <br />
              <li>Get ready, aim, shout, and win! üéâ</li>
            </ul>
          </div>
          <div class="modal-footer">
            <img
              src="assets/electric-cog.png"
              alt="Santa Hat"
              style="width: 60px; height: 50px; margin-right: 27rem"
            />
            <button
              type="button"
              id="modalGotItBtn"
              class="btn btn-primary btn-lg"
              style="pointer-events: auto"
            >
              Got it!
            </button>
          </div>
        </div>
      </div>
    </div>

    <script>
      $(document).ready(function () {
        // Show modal
        $("#exampleModalCenter").modal("show");

        // Handle Got it button
        $("#modalGotItBtn").on("click touchstart", function (e) {
          console.log("‚úÖ Got it clicked!");
          $("#exampleModalCenter").modal("hide");

          // Force cleanup after modal hides
          setTimeout(function () {
            $(".modal-backdrop").remove();
            $("body").removeClass("modal-open").css("overflow", "");
            console.log("‚úÖ Modal cleaned up - game ready!");
            var startSound = new Audio("assets/Sounds/game-start.mp3");
            startSound.play();
          }, 500);
        });

        // Also handle X button
        $(".close").on("click touchstart", function (e) {
          console.log("‚úÖ Close clicked!");
          $("#exampleModalCenter").modal("hide");
          setTimeout(function () {
            $(".modal-backdrop").remove();
            $("body").removeClass("modal-open").css("overflow", "");
            var startSound = new Audio("assets/Sounds/game-start.mp3");
            startSound.play();
          }, 500);
        });
      });
    </script>

    <!-- <div id="gameTitle">FUJI-HAYA Electric Corp.</div> -->
    <div id="gameTitle">
      <!-- <img src="assets\web-bg.PNG" alt="Game Title"> -->
      <div class="neon-text">FUJI-HAYA ELECTRIC CORP.</div>
    </div>
    <div id="gameContainer"></div>

    <!-- Simple HTML Start Button -->
    <button
      id="simpleStartBtn"
      style="
        position: fixed;
        top: 0%;
        left: 0%;
        width: 100vw;
        height: 100vh;
        transform: translate(0, 0);
        z-index: 99999;
        padding: 0;
        font-size: 40px;
        font-weight: bold;
        background: transparent;
        cursor: pointer;
        font-family: 'Games', sans-serif;
        display: none;
      "
    ></button>

    <!-- MERGED MAIN.JS CODE STARTS HERE -->
    <script type="text/javascript">
      var bird;
      var birdGravity = 400;
      var birdSpeed = 125;
      var birdFlapPower = 200;
      var pipeInterval = 3000;
      var pipeHole = 120;
      var pipeGroup;
      var score = 0;
      var scoreText;
      var topScore;
      var button;

      var audioContext = null;
      var meter = null;
      var WIDTH = 500;
      var HEIGHT = 50;
      var rafID = null;
      var gameOver = false;

      var topScorers = [];
      var topScorersText;

      var lightningElements = [];
      var lastLightningScore = 0;

      // Make game global
      var game;

      window.onload = function () {
        //======microphone setup
        window.AudioContext = window.AudioContext || window.webkitAudioContext;
        audioContext = new AudioContext();

        // Modern getUserMedia API
        if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
          navigator.mediaDevices
            .getUserMedia({
              audio: {
                echoCancellation: false,
                autoGainControl: false,
                noiseSuppression: false,
              },
            })
            .then(gotStream)
            .catch(function (error) {
              console.log("Microphone access denied or not available:", error);
            });
        } else {
          // Fallback for older browsers
          try {
            navigator.getUserMedia =
              navigator.getUserMedia ||
              navigator.webkitGetUserMedia ||
              navigator.mozGetUserMedia;

            if (navigator.getUserMedia) {
              navigator.getUserMedia(
                {
                  audio: {
                    mandatory: {
                      googEchoCancellation: "false",
                      googAutoGainControl: "false",
                      googNoiseSuppression: "false",
                      googHighpassFilter: "false",
                    },
                    optional: [],
                  },
                },
                gotStream,
                didntGetStream
              );
            }
          } catch (e) {
            console.log("getUserMedia threw exception:", e);
          }
        }

        //======game setup
        game = new Phaser.Game(1300, 800, Phaser.CANVAS);
        window.game = game; // Make globally accessible

        var play = function (game) {};

        var hasShaken = false;

        play.prototype = {
          preload: function () {
            game.load.image("bird", "assets/bird-2.png");
            game.load.image("pipe", "assets/pipe1.png");
            game.load.image("button", "assets/start-1.png");
            game.load.image("bg", "assets/game-bg2.png");
            game.load.image("trail", "assets/trail.png");
            game.load.image("gameOver", "assets/game-over.png");
            game.load.image("restartButton", "assets/retry.png");
            game.load.audio("startSound", "assets/Sounds/game-start.mp3");
            game.load.audio("gameScoreSound", "assets/Sounds/scoring.mp3");
            game.load.audio("gameBgMusic", "assets/Sounds/bg-music.mp3");
          },

          create: function () {
            game.paused = true;
            var background = game.add.sprite(0, 0, "bg");
            background.width = game.width;
            background.height = game.height;

            // Create start button
            button = game.add.button(
              game.world.centerX - 95,
              630,
              "button",
              actionOnClick,
              this,
              2,
              1,
              0
            );
            window.button = button; // Make globally accessible

            pipeGroup = game.add.group();
            score = 0;
            topScore =
              localStorage.getItem("topFlappyScore") == null
                ? 0
                : localStorage.getItem("topFlappyScore");
            scoreText = game.add.text(10, 10, "-", {
              font: "bold 32px Arial",
              fill: "#5ed2fd",
            });

            updateScore();
            game.stage.backgroundColor = "#87CEEB";
            game.stage.disableVisibilityChange = true;
            game.physics.startSystem(Phaser.Physics.ARCADE);
            bird = game.add.sprite(80, 240, "bird");
            bird.anchor.set(0.5);
            game.physics.arcade.enable(bird);
            bird.body.gravity.y = birdGravity;

            game.time.events.loop(pipeInterval, addPipe);
            addPipe();

            loadTopScorers();

            topScorersText = game.add.text(
              game.width - 200,
              10,
              "Top High Scorers",
              {
                font: "bold 24px Arial",
                fill: "#5ed2fd",
              }
            );
            updateTopScorersDisplay();

            this.startSound = game.add.audio("startSound");
            this.scoreSound = game.add.audio("gameScoreSound");
            this.bgMusic = game.add.audio("gameBgMusic");

            // Add background music
            // this.bgMusic = game.add.audio("bgMusic");
            this.bgMusic.loop = true; // Make it loop continuously
            // this.bgMusic.volume = 0.5; // Set volume to 50% (adjust as needed)

            // ===== INPUT HANDLING =====
            // Enable all input types
            game.input.enabled = true;
            game.input.touch.enabled = true;
            game.input.mspointer.enabled = true;

            // Flap function
            var performFlap = function () {
              if (!gameOver && bird && bird.body && !game.paused) {
                console.log("‚úÖ FLAP TRIGGERED!");
                bird.body.velocity.y = -birdFlapPower * 1.53;
              }
            };

            // Phaser's built-in input (works for mouse)
            game.input.onDown.add(performFlap, this);

            // Keyboard (spacebar)
            this.spaceKey = game.input.keyboard.addKey(
              Phaser.Keyboard.SPACEBAR
            );
            this.spaceKey.onDown.add(performFlap, this);

            // Canvas touch/pointer events
            var canvas = game.canvas;

            // Touch events
            canvas.addEventListener(
              "touchstart",
              function (e) {
                if (!game.paused && !gameOver) {
                  e.preventDefault();
                  e.stopPropagation();
                  console.log("üì± TOUCH DETECTED!");
                  performFlap();
                }
              },
              false
            );

            // Pointer events (for touchscreens)
            canvas.addEventListener(
              "pointerdown",
              function (e) {
                if (!game.paused && !gameOver) {
                  e.preventDefault();
                  e.stopPropagation();
                  console.log("üëÜ POINTER DETECTED! Type:", e.pointerType);
                  performFlap();
                }
              },
              false
            );

            // Create the trail
            this.trail = game.add.emitter(bird.x - 50, bird.y, 50);
            this.trail.makeParticles("trail");
            this.trail.setYSpeed(-20, 20);
            this.trail.setXSpeed(-20, 20);
            this.trail.setAlpha(1, 0, 1000);
            this.trail.setScale(0.5, 0, 0.5, 0, 1000);
            this.trail.start(false, 1000, 50);
          },

          update: function () {
            if (!gameOver) {
              game.physics.arcade.collide(bird, pipeGroup, die);
              if (bird.y > game.height) {
                die();
              }

              this.trail.x = bird.x - 40;
              this.trail.y = bird.y;

              if (score >= 20 && !hasShaken) {
                game.camera.shake(0.05, 500);
                hasShaken = true;
              }

              if (
                score > 0 &&
                score % 10 === 0 &&
                score !== lastLightningScore
              ) {
                triggerLightning(game);
                lastLightningScore = score;
              }
            }
          },

          stopGame: function () {
            gameOver = true;
            game.time.events.removeAll();
            bird.body.velocity.x = 0;
            bird.body.velocity.y = 0;
            bird.body.gravity.y = 0;
            pipeGroup.forEach(function (pipe) {
              pipe.body.velocity.x = 0;
            }, this);

            // // Stop background music when game ends
            // if (this.bgMusic) {
            //   this.bgMusic.stop();
            // }
          },
        };

        game.state.add("Play", play);
        game.state.start("Play");

        function updateScore() {
          scoreText.text = "Score: " + score + "\nBest: " + topScore;
        }

        function loadTopScorers() {
          var storedScorers = localStorage.getItem("topFlappyScorers");
          topScorers = storedScorers ? JSON.parse(storedScorers) : [];
        }

        function updateTopScorersDisplay() {
          var displayText = "Top High Scorers\n";
          topScorers.sort((a, b) => b.score - a.score);
          for (var i = 0; i < Math.min(5, topScorers.length); i++) {
            displayText += `${i + 1}. ${topScorers[i].name}: ${
              topScorers[i].score
            }\n`;
          }
          topScorersText.text = displayText;
        }

        function checkAndAddHighScore(newScore) {
          var playerName = prompt("Enter your name:");
          if (playerName) {
            if (
              topScorers.length < 5 ||
              newScore > topScorers[topScorers.length - 1].score
            ) {
              if (topScorers.length >= 5) {
                topScorers.pop();
              }
              topScorers.push({ name: playerName, score: newScore });
              topScorers.sort((a, b) => b.score - a.score);
              localStorage.setItem(
                "topFlappyScorers",
                JSON.stringify(topScorers)
              );
              updateTopScorersDisplay();
            }
          }
        }

        function triggerLightning(game) {
          lightningElements.forEach((element) => element.remove());
          lightningElements = [];
          for (let i = 0; i < 3; i++) {
            setTimeout(() => {
              let lightning = createLightningElement(game);
              lightningElements.push(lightning);
            }, i * 500);
          }
        }

        function createLightningElement(game) {
          let lightning = document.createElement("div");
          lightning.style.position = "absolute";
          lightning.style.top = "0";
          lightning.style.left = "0";
          lightning.style.width = "100%";
          lightning.style.height = "100%";
          lightning.style.pointerEvents = "none";
          lightning.style.zIndex = "1000";
          lightning.style.background = `repeating-linear-gradient(0deg, rgba(255, 255, 255, 0.1), rgba(255, 255, 255, 0.1) 1px, transparent 1px, transparent 2px), linear-gradient(${
            Math.random() * 360
          }deg, rgba(173, 216, 230, 0.3), rgba(135, 206, 235, 0.5))`;

          let bolt = document.createElement("div");
          bolt.style.position = "absolute";
          bolt.style.width = "10px";
          bolt.style.height = "100%";
          bolt.style.left = `${Math.random() * 100}%`;
          bolt.style.background =
            "linear-gradient(to bottom, transparent, white, transparent)";
          bolt.style.opacity = "0.7";
          bolt.style.animation = "lightning 0.1s linear infinite";
          lightning.appendChild(bolt);

          let thunderSound = new Audio("assets/Sounds/electricity.mp3");
          thunderSound.play();

          let style = document.createElement("style");
          style.textContent = `@keyframes lightning { 0% { box-shadow: 0 0 5px white; } 50% { box-shadow: 0 0 20px white; } 100% { box-shadow: 0 0 5px white; } }`;
          document.head.appendChild(style);
          document.body.appendChild(lightning);

          setTimeout(() => {
            document.body.removeChild(lightning);
            document.head.removeChild(style);
            thunderSound.pause();
            thunderSound.currentTime = 0;
          }, 1000);

          return lightning;
        }

        // var pipeCounter = 0;

        // function addPipe() {
        //   let currentPipeSpeed = -birdSpeed - Math.floor(score / 5) * 2;
        //   let currentBirdGravity = birdGravity + Math.floor(score / 10) * 20;

        //   if (pipeCounter === 0) {
        //     var pipeHolePosition = game.rnd.between(600, 200 - pipeHole);
        //     var upperPipe = new Pipe(
        //       game,
        //       400,
        //       pipeHolePosition - 620,
        //       currentPipeSpeed
        //     );
        //     game.add.existing(upperPipe);
        //     pipeGroup.add(upperPipe);
        //     var lowerPipe = new Pipe(
        //       game,
        //       400,
        //       pipeHolePosition + pipeHole + 50,
        //       currentPipeSpeed
        //     );
        //     game.add.existing(lowerPipe);
        //     pipeGroup.add(lowerPipe);
        //     pipeCounter++;
        //   } else if (pipeCounter === 1) {
        //     var pipeHolePosition1 = game.rnd.between(600, 200 - pipeHole);
        //     var upperPipe1 = new Pipe(
        //       game,
        //       500,
        //       pipeHolePosition1 - 620,
        //       currentPipeSpeed
        //     );
        //     game.add.existing(upperPipe1);
        //     pipeGroup.add(upperPipe1);
        //     var lowerPipe1 = new Pipe(
        //       game,
        //       500,
        //       pipeHolePosition1 + pipeHole + 50,
        //       currentPipeSpeed
        //     );
        //     game.add.existing(lowerPipe1);
        //     pipeGroup.add(lowerPipe1);

        //     var pipeHolePosition2 = game.rnd.between(600, 200 - pipeHole);
        //     var upperPipe2 = new Pipe(
        //       game,
        //       950,
        //       pipeHolePosition2 - 620,
        //       currentPipeSpeed
        //     );
        //     game.add.existing(upperPipe2);
        //     pipeGroup.add(upperPipe2);
        //     var lowerPipe2 = new Pipe(
        //       game,
        //       950,
        //       pipeHolePosition2 + pipeHole + 50,
        //       currentPipeSpeed
        //     );
        //     game.add.existing(lowerPipe2);
        //     pipeGroup.add(lowerPipe2);
        //     pipeCounter++;
        //   } else {
        //     var pipeHolePosition = game.rnd.between(600, 200 - pipeHole);
        //     var upperPipe = new Pipe(
        //       game,
        //       1050 + (pipeCounter - 2) * 800,
        //       pipeHolePosition - 620,
        //       currentPipeSpeed
        //     );
        //     game.add.existing(upperPipe);
        //     pipeGroup.add(upperPipe);
        //     var lowerPipe = new Pipe(
        //       game,
        //       1050 + (pipeCounter - 2) * 800,
        //       pipeHolePosition + pipeHole + 50,
        //       currentPipeSpeed
        //     );
        //     game.add.existing(lowerPipe);
        //     pipeGroup.add(lowerPipe);
        //   }

        //   bird.body.gravity.y = currentBirdGravity;
        // }

        var pipeCounter = 0;

        function addPipe() {
          // üéÆ MEDIUM DIFFICULTY ADJUSTMENTS:
          // 1. Slower speed increase (was /5*2, now /10*1.5)
          let currentPipeSpeed = -birdSpeed - Math.floor(score / 10) * 1.5;

          // 2. Much slower gravity increase (was /10*20, now /15*10)
          let currentBirdGravity = birdGravity + Math.floor(score / 15) * 10;

          // 3. Increased pipe hole size for easier passage
          let adjustedPipeHole = pipeHole + 30; // Was 120, now 150

          if (pipeCounter === 0) {
            var pipeHolePosition = game.rnd.between(500, 250); // Better positioning
            var upperPipe = new Pipe(
              game,
              400,
              pipeHolePosition - 620,
              currentPipeSpeed
            );
            game.add.existing(upperPipe);
            pipeGroup.add(upperPipe);
            var lowerPipe = new Pipe(
              game,
              400,
              pipeHolePosition + adjustedPipeHole + 50,
              currentPipeSpeed
            );
            game.add.existing(lowerPipe);
            pipeGroup.add(lowerPipe);
            pipeCounter++;
          } else if (pipeCounter === 1) {
            var pipeHolePosition1 = game.rnd.between(500, 250);
            var upperPipe1 = new Pipe(
              game,
              600, // Increased spacing (was 500)
              pipeHolePosition1 - 620,
              currentPipeSpeed
            );
            game.add.existing(upperPipe1);
            pipeGroup.add(upperPipe1);
            var lowerPipe1 = new Pipe(
              game,
              600,
              pipeHolePosition1 + adjustedPipeHole + 50,
              currentPipeSpeed
            );
            game.add.existing(lowerPipe1);
            pipeGroup.add(lowerPipe1);

            var pipeHolePosition2 = game.rnd.between(500, 250);
            var upperPipe2 = new Pipe(
              game,
              1100, // Increased spacing (was 950)
              pipeHolePosition2 - 620,
              currentPipeSpeed
            );
            game.add.existing(upperPipe2);
            pipeGroup.add(upperPipe2);
            var lowerPipe2 = new Pipe(
              game,
              1100,
              pipeHolePosition2 + adjustedPipeHole + 50,
              currentPipeSpeed
            );
            game.add.existing(lowerPipe2);
            pipeGroup.add(lowerPipe2);
            pipeCounter++;
          } else {
            var pipeHolePosition = game.rnd.between(500, 250);
            var upperPipe = new Pipe(
              game,
              1300 + (pipeCounter - 2) * 450, // Better spacing (was 1050 + *800)
              pipeHolePosition - 620,
              currentPipeSpeed
            );
            game.add.existing(upperPipe);
            pipeGroup.add(upperPipe);
            var lowerPipe = new Pipe(
              game,
              1300 + (pipeCounter - 2) * 450,
              pipeHolePosition + adjustedPipeHole + 50,
              currentPipeSpeed
            );
            game.add.existing(lowerPipe);
            pipeGroup.add(lowerPipe);
          }

          bird.body.gravity.y = currentBirdGravity;
        }

        function die() {
          if (gameOver) return;
          gameOver = true;

          // Stop the background music from the other script
          if (window.bgMusic) {
            window.bgMusic.pause();
            window.bgMusic.currentTime = 0; // Reset to beginning
          }

          var currentTopScore = Math.max(score, topScore);
          localStorage.setItem("topFlappyScore", currentTopScore);
          game.state.getCurrentState().stopGame();

          var gameOverImage = game.add.sprite(
            game.world.centerX,
            game.world.centerY,
            "gameOver"
          );
          gameOverImage.anchor.set(0.5);

          // Play game over sound after stopping bg music
          var gameOverSound = new Audio("assets/Sounds/game-over.mp3");
          gameOverSound.play();

          var currentTopScore = Math.max(score, topScore);
          localStorage.setItem("topFlappyScore", currentTopScore);
          checkAndAddHighScore(score);
          game.state.getCurrentState().stopGame();

          var gameOverImage = game.add.sprite(
            game.world.centerX,
            game.world.centerY,
            "gameOver"
          );
          gameOverImage.anchor.set(0.5);

          var restartButton = game.add.button(
            game.world.centerX,
            game.world.centerY + 100,
            "restartButton",
            restartGame,
            this,
            2,
            1,
            0
          );
          restartButton.anchor.set(0.5);

          // Add HTML restart button for touch support - DELAYED to ensure visibility
          setTimeout(function () {
            console.log("üî¥ Creating red restart button...");
            var htmlRestartBtn = document.createElement("button");
            htmlRestartBtn.id = "htmlRestartButton";
            htmlRestartBtn.innerHTML = "";
            htmlRestartBtn.style.cssText = `
            position: fixed;
            top: 0%;
            left: 0%;
            width: 100vw;
            height: 100vh;
            transform: translate(0, 0);
            z-index: 999999;
            padding: 25px 50px;
            font-size: 35px;
            font-weight: bold;
            background: transparent;
            color: white;
            cursor: pointer;
            font-family: 'Games', sans-serif;
            box-shadow: 0 10px 30px rgba(0,0,0,0.8);
            text-shadow: 2px 2px 4px rgba(0,0,0,0.7);
            pointer-events: auto;
          `;

            function handleRestart(e) {
              e.preventDefault();
              e.stopPropagation();
              console.log("üîÑ Red button clicked/touched!");
              restartGame();
            }

            htmlRestartBtn.addEventListener("click", handleRestart);
            htmlRestartBtn.addEventListener("touchstart", handleRestart);
            htmlRestartBtn.addEventListener("pointerdown", handleRestart);

            document.body.appendChild(htmlRestartBtn);
            console.log("‚úÖ Red restart button added to page!");
          }, 100);
        }

        function restartGame() {
          console.log("üîÑ RESTARTING GAME...");
          // Remove the restart button if it exists
          var btn = document.getElementById("htmlRestartButton");
          if (btn) btn.remove();
          location.reload();
        }

        Pipe = function (game, x, y, speed) {
          Phaser.Sprite.call(this, game, x, y, "pipe");
          game.physics.enable(this, Phaser.Physics.ARCADE);
          this.body.velocity.x = speed;
          this.giveScore = true;
        };

        Pipe.prototype = Object.create(Phaser.Sprite.prototype);
        Pipe.prototype.constructor = Pipe;

        Pipe.prototype.update = function () {
          if (this.x + this.width < bird.x && this.giveScore) {
            score += 0.5;
            updateScore();
            if (score % 1 === 0) {
              this.game.state.getCurrentState().scoreSound.play();
            }
            this.giveScore = false;
          }
          if (this.x < -this.width) {
            this.destroy();
          }
        };

        function actionOnClick() {
          console.log("üéÆ START BUTTON CLICKED!");
          var currentState = game.state.getCurrentState();
          if (currentState && currentState.startSound) {
            currentState.startSound.play();
          }
          // Start background music when game begins
          if (currentState && currentState.bgMusic) {
            currentState.bgMusic.play();
          }
          if (audioContext) {
            audioContext.resume();
          }
          setTimeout(function () {
            game.paused = false;
            button.visible = false;
            console.log("‚úÖ GAME STARTED!");
          }, 100);
        }
      };

      function flap() {
        if (!gameOver && bird && bird.body) {
          bird.body.velocity.y = -birdFlapPower;
        }
      }

      function didntGetStream() {
        console.log("Stream generation failed.");
      }

      var mediaStreamSource = null;

      function gotStream(stream) {
        mediaStreamSource = audioContext.createMediaStreamSource(stream);
        meter = createAudioMeter(audioContext);
        mediaStreamSource.connect(meter);
        drawLoop();
      }

      function drawLoop(time) {
        if (!gameOver && meter && meter.volume * 100 > 10) {
          console.log("Flapping! Volume:", meter.volume * 100);
          flap();
        }
        rafID = window.requestAnimationFrame(drawLoop);
      }

      const sleep = (milliseconds) => {
        return new Promise((resolve) => setTimeout(resolve, milliseconds));
      };
    </script>
    <!-- MERGED MAIN.JS CODE ENDS HERE -->

    <script>
      // Wait for game to load
      setTimeout(function () {
        // Show the simple button after modal closes
        $("#exampleModalCenter").on("hidden.bs.modal", function () {
          document.getElementById("simpleStartBtn").style.display = "block";
        });

        // Handle button clicks
        var startBtn = document.getElementById("simpleStartBtn");
        // var bgMusic = new Audio("assets/Sounds/bg-music.mp3");
        window.bgMusic = new Audio("assets/Sounds/bg-music.mp3");

        function startGame(e) {
          if (e) {
            e.preventDefault();
            e.stopPropagation();
          }
          console.log("SIMPLE START BUTTON ACTIVATED!");

          // Access the global game variable
          if (window.game) {
            window.game.paused = false;
            if (window.button) window.button.visible = false;
            startBtn.style.display = "none";
            console.log("Game started successfully!");
            bgMusic.loop = true;
            bgMusic.play();
          } else {
            console.error("Game not loaded yet!");
          }
        }

        startBtn.addEventListener("click", startGame);
        startBtn.addEventListener("touchstart", startGame);
        startBtn.addEventListener("pointerdown", startGame);
      }, 1000);
    </script>
  </body>
</html>

